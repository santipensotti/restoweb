@page "/map"
@inject HttpClient Http
@inject IJSRuntime JS
@using System.Text.Json.Serialization


<h3>Mi Mapa</h3>
<div id="map" style="height: 500px;"></div>

@code {
    private double Latitude { get; set; }
    private double Longitude { get; set; }
    private List<Point> puntos = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await GetLocationAsync();
            await JS.InvokeVoidAsync("initMap", puntos);
        }
    }

    private async Task GetLocationAsync()
    {
        // Obtiene la ubicación actual a través de JavaScript
        var location = await JS.InvokeAsync<double[]>("getLocation");
        Latitude = location[0];
        Longitude = location[1];

        // Agrega la ubicación actual a la lista de puntos
        puntos.Add(new Point { Lat = Latitude, Lng = Longitude });

        // Llama al API para obtener las coordenadas de los restaurantes
        var coordinates = await Http.GetFromJsonAsync<List<Point>>("api/restaurant/getMaps");
        if (coordinates != null)
        {
            puntos.AddRange(coordinates);
        }
        else
        {
            // Manejo de errores o respuesta vacía
        }
    }

    // Clase para representar un punto en el mapa
    public class Point
    {
        [JsonPropertyName("lat")]
        public double Lat { get; set; }

        [JsonPropertyName("lng")]
        public double Lng { get; set; }
    }
}
